<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loan Calculator</title>
    <!-- Normalize styles across browsers -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/1.1.0/modern-normalize.min.css"
    />
    <!-- Custom styles for this application. Use url_for to generate the static path -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <header class="site-header">
      <h1>Detailed Loan Calculator</h1>
    </header>
    <main class="container">
      {# Display an error if present #} {% if error %}
      <div class="error">{{ error }}</div>
      {% endif %}
      <!-- Input form -->
      <form method="post" class="calc-form">
        <fieldset class="section">
          <legend>Loan Parameters</legend>
          <div class="form-grid">
            <div class="form-field">
              <label for="principal">Principal</label>
              <input
                type="text"
                id="principal"
                name="principal"
                placeholder="e.g. 988000"
                required
              />
            </div>
            <div class="form-field">
              <label for="rate">Annual Rate (%)</label>
              <input
                type="number"
                step="0.01"
                id="rate"
                name="rate"
                placeholder="e.g. 6.19"
                required
              />
            </div>
            <div class="form-field">
              <label for="term">Term (months)</label>
              <input
                type="number"
                id="term"
                name="term"
                placeholder="e.g. 360"
                required
              />
            </div>
            <div class="form-field">
              <label for="loan_type">Installment Type</label>
              <select id="loan_type" name="loan_type">
                <option value="annuity">Annuity</option>
                <option value="decreasing">Decreasing</option>
              </select>
            </div>
            <div class="form-field">
              <label for="start_date">Start Date</label>
              <input type="month" id="start_date" name="start_date" required />
            </div>
          </div>
        </fieldset>
        <fieldset class="section">
          <legend>Adjustments</legend>
          <div class="form-grid">
            <div class="form-field">
              <label for="down_payment">Down Payment</label>
              <input
                type="text"
                id="down_payment"
                name="down_payment"
                placeholder="e.g. 150000"
              />
            </div>
            <div class="form-field">
              <label for="tranches">Tranches</label>
              <textarea
                id="tranches"
                name="tranches"
                placeholder="YYYY-MM:PERCENT, one per line or comma-separated"
              ></textarea>
            </div>
            <div class="form-field">
              <label for="overpayments">Overpayments</label>
              <textarea
                id="overpayments"
                name="overpayments"
                placeholder="YYYY-MM:AMOUNT:TYPE, one per line or comma-separated"
              ></textarea>
            </div>
            <div class="form-field">
              <label for="monthly_overpayment">Monthly Overpayment</label>
              <input
                type="text"
                id="monthly_overpayment"
                name="monthly_overpayment"
                placeholder="AMOUNT:TYPE (e.g. 500:term)"
              />
            </div>
            <div class="form-field">
              <label for="constant_payment">Constant Payment</label>
              <input
                type="text"
                id="constant_payment"
                name="constant_payment"
                placeholder="e.g. 7000"
              />
            </div>
            <div class="form-field">
              <label for="holidays">Holidays</label>
              <textarea
                id="holidays"
                name="holidays"
                placeholder="YYYY-MM, one per line or comma-separated"
              ></textarea>
            </div>
          </div>
        </fieldset>
        <div class="form-actions">
          <button type="submit" class="btn">Calculate</button>
        </div>
      </form>
      <!-- Summary results -->
      {% if summary %}
      <section class="results">
        <h2>Loan Summary</h2>
        <table class="summary-table">
          {% for key, value in summary.items() %}
          <tr>
            <th>{{ key }}</th>
            <td>{{ value }}</td>
          </tr>
          {% endfor %}
        </table>
      </section>
      {% endif %}
      <!-- Schedule results -->
      {% if schedule %}
      <section class="results schedule-wrapper">
        <h2>Amortization Schedule</h2>
        <table id="schedule-table" class="schedule-table">
          {% if schedule and schedule|length > 0 %}
          <thead>
            <tr>
              {% for col_name in schedule[0].keys() %}
              <th>{{ col_name }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in schedule %}
            <tr>
              {% for value in row.values() %}
              <td>{{ value }}</td>
              {% endfor %}
            </tr>
            {% endfor %}
          </tbody>
          {% endif %}
        </table>
        {% if summary.truncated %}
        <div class="truncate-note">
          Results truncated: {{ summary.truncated }} rows omitted.
        </div>
        {% endif %}
      </section>
      {% endif %}
    </main>
  </body>
</html>
